<!DOCTYPE html>
<html lang="en-us">

<head>
  <title>Bringing the cloud to your community | ii.nz</title>

  <meta name="ii" content="cool">
  <meta charset="UTF-8">
  <meta name="language" content="en">
  <meta name="description" content="">
  <meta name="keywords" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">

  
  

  <link rel="shortcut icon" type="image/png" href="/favicon.ico" />


  
  
    
 
  
  

  

  
    
    <link type="text/css" rel="stylesheet" href="/css/post.min.2cdedeaee06d510cb6af67a8b95ad416aaefd78e2001e4f3e84bd07b2aa0e45d.css" integrity="sha256-LN7eruBtUQy2r2eouVrUFqrv144gAeTz6EvQeyqg5F0="/>
  
    
    <link type="text/css" rel="stylesheet" href="/css/custom.min.e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855.css" integrity="sha256-47DEQpj8HBSa&#43;/TImW&#43;5JCeuQeRkm5NMpJWZG3hSuFU="/>
  

  
   
  

<script type="application/ld+json">
  
    {
      "@context": "http://schema.org",
      "@type": "WebSite",
      "url": "https:\/\/ii.nz\/post\/bringing-the-cloud-to-your-community\/",
      "name": "Bringing the cloud to your community",
      "author": {
        "@type": "Person",
        "name": ""
      },
      "description": ""
    }
  
  </script>
<link rel='stylesheet' type='text/css' href='/ii-style.css'>
</head>

<body>
  <div class="burger__container">
  <div class="burger" aria-controls="navigation" aria-label="Menu">
    <div class="burger__meat burger__meat--1"></div>
    <div class="burger__meat burger__meat--2"></div>
    <div class="burger__meat burger__meat--3"></div>
  </div>
    <h1>ii.nz<span class="fancy">.</span></h1>
</div>


  <nav class="nav" id="navigation">
  <ul class="nav__list">
    
    
      <li>
        <a  href="/">home üè†</a>
      </li>
    
      <li>
        <a  href="/about">about üßÑ</a>
      </li>
    
      <li>
        <a  href="/post">posts üìú</a>
      </li>
    
      <li>
        <a  href="/stories">stories üó®Ô∏è </a>
      </li>
    
  </ul>
</nav>


  <main>
    
    

    <div class="flex-wrapper">
      <div class="post__container">
        <div class="post">
          <header class="post__header">
            
            <div class="post__metadata">
              <h1 id="post__title">Bringing the cloud to your community</h1>
              üìÜ<time datetime="2017-01-04 00:00:00 &#43;0000 UTC" class="post__date">Jan 4 2017</time> 
              <span class="post__date">üïö 3 min read</span>
              <div class="authors">
                by
                
                <a class="author" href=/author/hippie-hacker>
                  Hippie Hacker
                </a>
                
              </div>
              
            </div>
          </header>
          <article class="post__content">
            
<h2 id="creating-local-clouds-should-not-be-hard"><a href="#creating-local-clouds-should-not-be-hard" class="anchor">#</a>creating local clouds should not be hard</h2>
<p>It should be easy to deploy complex cloud infrastructure onto <em>real hardware</em>
without having to be an IT guru. We want to use a $9 C.H.I.P flashed from the
web with a paperclip to setup the same open source cloud infrastructure used by
Google.</p>
<p>Several years ago we demoed a Banana Pi powering on and installing different
cloud operating systems to real hardware.</p>
<p>The advent of <a href="https://www.docker.com/" 
  
   target="_blank" rel="noreferrer noopener" 
>Docker</a>
 and IoT provisioning platforms
that utilize containers like <a href="http://resin.io/" 
  
   target="_blank" rel="noreferrer noopener" 
>Resin</a>
 are democratizing access
to deploy and manage complex infrastructure.</p>
<h2 id="resin-and-iot-hardware-can-create-and-manage-your-local-cloud"><a href="#resin-and-iot-hardware-can-create-and-manage-your-local-cloud" class="anchor">#</a>Resin and IoT hardware can create and manage your local cloud</h2>
<p>It just takes a few steps:</p>
<ul>
<li>flash a <a href="https://getchip.com/pages/chip" 
  
   target="_blank" rel="noreferrer noopener" 
>C.H.I.P.</a>
 (or Raspberry Pi) with
Resin OS via the web</li>
<li>connect the Resin device to some computers set to <a href="https://en.wikipedia.org/wiki/Preboot_Execution_Environment" 
  
   target="_blank" rel="noreferrer noopener" 
>netboot
PXE</a>
</li>
<li>watch your Resin console as your computers are turned into a cloud
(Kubernetes running GitLab or OpenStack)</li>
</ul>
<h3 id="flash-a-chip-or-raspi-with-resin-os"><a href="#flash-a-chip-or-raspi-with-resin-os" class="anchor">#</a>Flash a CHIP (or Raspi) with Resin OS</h3>
<p>We have recently pulled together a <a href="https://gitlab.ii.org.nz/iichip/Hanlon/blob/resin/Dockerfile" 
  
   target="_blank" rel="noreferrer noopener" 
>Docker
build</a>

that we push to our resin project.</p>
<p><img src="/images/2017/01/ii_k8s_resin.png" alt="image"></p>
<h3 id="connect-the-resin-device-to-some-computers-configured-to-netboot"><a href="#connect-the-resin-device-to-some-computers-configured-to-netboot" class="anchor">#</a>Connect the Resin device to some computers configured to netboot</h3>
<p>Once the Resin + ii device is connected to our network we power on the servers.
This could be done manually, but what fun would that be?</p>
<p><img src="/images/2017/01/ii_poweron.png" alt="image"></p>
<p>We use some software that listens to the network boot requests and orchestrates
the installation of the OS installs called
<a href="https://github.com/csc/Hanlon" 
  
   target="_blank" rel="noreferrer noopener" 
>Hanlon</a>
.</p>
<p>When the servers power up they register with the Hanlon. This process is <a href="https://github.com/csc/Hanlon/wiki/How-is-it-all-connected#breakdown" 
  
   target="_blank" rel="noreferrer noopener" 
>fairly
complex</a>

but allows us to <a href="https://gitlab.ii.org.nz/iichip/chef-provisioning-k8s/blob/master/provision/recipes/node_setup.rb" 
  
   target="_blank" rel="noreferrer noopener" 
>save information about the server
hardware</a>

and the servers wait to be told what to do next via the <a href="https://github.com/csc/Hanlon/wiki/Hanlon-API-Overview" 
  
   target="_blank" rel="noreferrer noopener" 
>Hanlon
API</a>
.</p>
<p><img src="/images/2017/01/ii_register.png" alt="image"></p>
<h3 id="watch-your-resin-console-as-your-computers-are-turned-into-a-cloud"><a href="#watch-your-resin-console-as-your-computers-are-turned-into-a-cloud" class="anchor">#</a>Watch your Resin console as your computers are turned into a cloud</h3>
<p>Once we have enough nodes, we use Hanlon info about the hardware (number of
cores for now) to <a href="https://gitlab.ii.org.nz/iichip/chef-provisioning-k8s/blob/master/provision/recipes/node_state.rb" 
  
   target="_blank" rel="noreferrer noopener" 
>select the right
hardware</a>

for the Kubernetes master (the one with the least cores) and allocate the rest
as minions.</p>
<p><img src="/images/2017/01/ii_k8s_waiting.png" alt="image"></p>
<p>This allows us to generate a local ssl Certificate Authority and <a href="https://gitlab.ii.org.nz/iichip/chef-provisioning-k8s/blob/master/provision/recipes/certs.rb" 
  
   target="_blank" rel="noreferrer noopener" 
>create signed
certificates</a>

for all our nodes.</p>
<p><img src="/images/2017/01/ii_certs.png" alt="image"></p>
<p>Now we tie it all together with <a href="https://gitlab.ii.org.nz/iichip/chef-provisioning-k8s/blob/master/provision/recipes/hanlon.rb" 
  
   target="_blank" rel="noreferrer noopener" 
>Hanlon tags, models, and policies per
node</a>

that deploy CoreOS.</p>
<p><img src="/images/2017/01/ii_provision_hanlon.png" alt="image"></p>
<p>We wait for all the <a href="https://gitlab.ii.org.nz/iichip/chef-provisioning-k8s/blob/master/provision/recipes/hanlon.rb#L51" 
  
   target="_blank" rel="noreferrer noopener" 
>CoreOS nodes to be provisioned and
available</a>
,
logging the state changes along the way.</p>
<p><img src="/images/2017/01/ii_os_complete.png" alt="image"></p>
<p>Next we use chef-provisioning-ssh to <a href="https://gitlab.ii.org.nz/iichip/chef-provisioning-k8s/blob/master/provision/recipes/via_ssh.rb#L10" 
  
   target="_blank" rel="noreferrer noopener" 
>ensure each CoreOS node is
ready</a>
.</p>
<p><img src="/images/2017/01/ii_k8s_ready.png" alt="ssh"></p>
<p>Then the master <a href="https://gitlab.ii.org.nz/iichip/chef-provisioning-k8s/blob/master/provision/recipes/via_ssh.rb#L46" 
  
   target="_blank" rel="noreferrer noopener" 
>needs to be
initialized</a>
.</p>
<p><img src="/images/2017/01/ii_k8s_configure_master.png" alt="initmaster"></p>
<p>And then <a href="https://gitlab.ii.org.nz/iichip/chef-provisioning-k8s/blob/master/provision/recipes/via_ssh.rb#L83" 
  
   target="_blank" rel="noreferrer noopener" 
>the
minions</a>
.</p>
<p><img src="/images/2017/01/ii_k8s_minions.png" alt="init minions"></p>
<p>We <a href="https://gitlab.ii.org.nz/iichip/chef-provisioning-k8s/blob/master/provision/recipes/kubectl.rb" 
  
   target="_blank" rel="noreferrer noopener" 
>setup
kubectl</a>

to communicate to our new Kubernetes cluster.</p>
<p><img src="/images/2017/01/ii_k8s_kubectl.png" alt="setup kubectl"></p>
<p><a href="https://gitlab.ii.org.nz/iichip/chef-provisioning-k8s/blob/master/provision/recipes/main.rb#L20" 
  
   target="_blank" rel="noreferrer noopener" 
>Create Kubernetes
manifest</a>

specific to our <a href="https://gitlab.ii.org.nz/iichip/chef-provisioning-k8s/tree/master/provision/files" 
  
   target="_blank" rel="noreferrer noopener" 
>deploy of
gitlab</a>
.</p>
<p><img src="/images/2017/01/ii_k8s_gitlab.png" alt="install gitlab onkubernetes"></p>
<p>The end result is a gitlab instance running on kubernetes!</p>
<p><img src="/images/2017/01/ii_k8s_pods.png" alt="kubectl pods"></p>
<p>We can looking up our service ip, which we can add to DNS.</p>
<p><img src="/images/2017/01/ii_k8s_ingress.png" alt="kubectl ingress"></p>
<h3 id="start-developing-in-your-community-on-a-local-cloud"><a href="#start-developing-in-your-community-on-a-local-cloud" class="anchor">#</a>Start developing in your community on a local cloud</h3>
<p>Yes&hellip; that&rsquo;s gitlab, deployed from any resin device, to real hardware running kubernetes.</p>
<p><img src="/images/2017/01/ii_gitlab_running.png" alt="gitlabrunning"></p>
<h2 id="why-is-this-important"><a href="#why-is-this-important" class="anchor">#</a>Why is this important?</h2>
<p>GitLab published a blog post detailing how quickly you can take your ideas to production using a local cloud</p>
<ul>
<li><a href="https://about.gitlab.com/2016/11/14/idea-to-production/" 
  
   target="_blank" rel="noreferrer noopener" 
>In 13 minutes from Kubernetes to a complete application development
tool</a>
</li>
</ul>
<p><strong>There are so many places to go from here. We are looking for funding and
people who share our passion for creating instant infrastructure that is easy
for others to use, change, and replicate.</strong> Send <a href="mailto://ii.org.nz/" 
   target="_blank" 
  
>us an
email</a>
 or give us a ring at +64 22 646 1502.</p>


            
          </article>
          

<ul class="tags__list">
    
    <li class="tag__item">
        <a class="tag__link" href="https://ii.nz/tags/kubernetes/">kubernetes</a>
    </li>
    <li class="tag__item">
        <a class="tag__link" href="https://ii.nz/tags/cloud/">cloud</a>
    </li></ul>

 <div class="pagination">
  
    <a class="pagination__item" href="https://ii.nz/post/flashing-hardware-with-software-from-the-web/">
        <span class="pagination__label"></span>
        <span class="pagination__title">Flashing hardware with software from the web</span>
    </a>
  

  
    <a class="pagination__item" href="https://ii.nz/post/deplying-talos-to-equinix/">
      <span class="pagination__label"></span>
      <span class="pagination__title" >Deploying Talos to Equinix</span>
    </a>
  
</div>

          
          <footer class="post__footer">
            


<div class="social-icons">
  
    
    
      <a class="social-icons__link" rel="me" title="GitLab"
         href="https://gitlab.com/ii"
         target="_blank" rel="noopener">
        <div class="social-icons__icon" style="background-image: url('https://ii.nz/svg/gitlab.svg')"></div>
      </a>
    
  
    
    
      <a class="social-icons__link" rel="me" title="GitHub"
         href="https://github.com/ii"
         target="_blank" rel="noopener">
        <div class="social-icons__icon" style="background-image: url('https://ii.nz/svg/github.svg')"></div>
      </a>
    
  
    
    
      <a class="social-icons__link" rel="me" title="Email"
         href="mailto:hello@ii.coop"
         target="_blank" rel="noopener">
        <div class="social-icons__icon" style="background-image: url('https://ii.nz/svg/email.svg')"></div>
      </a>
    
  
</div>

            <p>¬© 2023</p>
          </footer>
          </div>
      </div>
      
    </div>


  </main>

   

  
  <script src="/js/index.min.301a8b0870381bf76b3b5182e8966d363a0474281183439beb024d8b8228fc66.js" integrity="sha256-MBqLCHA4G/drO1GC6JZtNjoEdCgRg0Ob6wJNi4Io/GY=" crossorigin="anonymous"></script>
  
  
  <script src="https://unpkg.com/prismjs@1.20.0/components/prism-core.min.js"></script>

  
  <script src="https://unpkg.com/prismjs@1.20.0/plugins/autoloader/prism-autoloader.min.js"
    data-autoloader-path="https://unpkg.com/prismjs@1.20.0/components/"></script>

  


</body>

</html>
